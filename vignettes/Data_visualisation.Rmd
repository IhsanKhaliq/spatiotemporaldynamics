---
title: "Visualise spatiotemporal spread data"
author: "Ihsan Khaliq"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Visualise spatiotemporal spread data}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, error = TRUE)
knitr::opts_chunk$set(progress = TRUE, verbose = TRUE)
knitr::opts_chunk$set(
  echo = TRUE,
  fig.width = 7,
  fig.height = 7,
  fig.align = "center"
)
```

## Load libraries 

```{r libraries, message=FALSE, echo=TRUE, warning=FALSE}
library("readxl")
library("ggplot2")
library("theme.usq")
library("dplyr")
library("knitr")
```

## Visualise temporal GAMs


## Import data

Spreadsheet-1 of `SpatioTemporalSpreadData.xlsx` has temporal spread data, spreadsheet-2 has spatial spread data and spreadsheet-3 has both combined with an extra column `spread_type` indicating spatial and temporal spread.

```{r import-data}
dat <-
   read_excel(
      system.file("extdata", "SpatioTemporalSpreadData.xlsx",
                  package = "spatiotemporaldynamics"),
      sheet = 1
   )
```

## Examine data

```{r examine data}
str(dat)
```


```{r prepare data}
cols_1 <-
   c(
      "location",
      "distance",
      "plot_number",
      "quadrat",
      "min_temp",
      "max_temp",
      "min_rh",
      "max_rh",
      "avg_wind_speed",
      "avg_rh",
      "avg_temp",
      "assessment_number",
      "total_rain"
   )
dat[cols_1] <- lapply(dat[cols_1], factor)

cols_2 <- c("infected_plants", "total_plants")
dat[cols_2] <- lapply(dat[cols_2], as.integer)
dat$assessment_date <- as.Date(dat$assessment_date)
```

## Re-check class

```{r check class}
sapply(dat, class)
```

## Visualise data distribution 

### Density plot

```{r}
ggplot(dat, aes(incidence)) +
   geom_density() +
   facet_grid(distance ~ location, labeller = label_both) +
   theme_usq()
```

### Line plot with median and max/min values

```{r}
ggplot(
   data = dat,
   mapping = aes(x = assessment_date, y = incidence),
   colour = usq_cols("usq charcoal")) +
   geom_pointrange(
      stat = "summary",
      fun.min = min,
      fun.max = max,
      fun = median
   ) +
   stat_summary(
      fun = median,
      geom = "line",
      aes(group = location),
      colour = usq_cols("usq charcoal")
   ) +
   facet_grid(distance ~ location) +
   xlab("Assessment Date") +
   ylab("Disease Incidence") +
   theme_usq()
```


### Scatter plot with smoothed fit lines

```{r}
ggplot(dat, aes(assessment_date, incidence)) +
   geom_point() +
   geom_smooth() +
   facet_grid(distance ~ location, labeller = label_both) +
   xlab("Assessment Date") +
   ylab("Disease Incidence") +
   theme_usq()
```


## Wind rose

### Import wind direction data and covert wind direction from text to degrees

```{r plot-wind-rose}
wind_dat <-
   read_excel(
      system.file("extdata", "WindDirectionData.xlsx",
                  package = "spatiotemporaldynamics"),
      sheet = 1
   ) %>%
   mutate(
      wind_direction_degrees = case_when(
         wind_direction == "N" ~ 1,
         wind_direction == "NbE" ~ 2,
         wind_direction == "NNE" ~ 3,
         wind_direction == "NEbN" ~ 4,
         wind_direction == "NE" ~ 5,
         wind_direction == "NEbE" ~ 6,
         wind_direction == "ENE" ~ 7,
         wind_direction == "EbN" ~ 8,
         wind_direction == "E" ~ 9,
         wind_direction == "EbS" ~ 10,
         wind_direction == "ESE" ~ 11,
         wind_direction == "SEbE" ~ 12,
         wind_direction == "SE" ~ 13,
         wind_direction == "SEbS" ~ 14,
         wind_direction == "SSE" ~ 15,
         wind_direction == "SbE" ~ 16,
         wind_direction == "S" ~ 17,
         wind_direction == "SbW" ~ 18,
         wind_direction == "SSW" ~ 19,
         wind_direction == "SWbS" ~ 20,
         wind_direction == "SW" ~ 21,
         wind_direction == "SWbW" ~ 22,
         wind_direction == "WSW" ~ 23,
         wind_direction == "WbS" ~ 24,
         wind_direction == "W" ~ 25,
         wind_direction == "WbN" ~ 26,
         wind_direction == "WNW" ~ 27,
         wind_direction == "NWbW" ~ 28,
         wind_direction == "NW" ~ 29,
         wind_direction == "NWbN" ~ 30,
         wind_direction == "NNW" ~ 31,
         wind_direction == "NbW" ~ 32
      )
   )

```

